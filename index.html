<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bakery POS</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff7e6;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      color: #4a4a4a;
    }
    h1 {
      text-align: center;
      color: #b35d1d;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    thead {
      background-color: #b35d1d;
      color: white;
    }
    tbody tr:nth-child(even) {
      background: #f9f4ec;
    }
    input {
      padding: 5px;
      text-align: center;
    }
    button {
      background: #b35d1d;
      color: white;
      padding: 10px 20px;
      border: none;
      margin-top: 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #8b4313;
    }
    #result {
      white-space: pre-wrap;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-top: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      font-family: monospace;
    }
  </style>
</head>
<body>

<h1>New Station viwe Hotel & Bakery</h1>

<form id="posForm">
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Price (Rs.)</th>
        <th>Quantity</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody id="itemBody">
      <!-- Items go here -->
    </tbody>
  </table>

  <button type="button" onclick="addItem()">+ Add Item</button><br><br>

  <label>Discount (Rs.): <input type="number" id="discount" value="0" min="0" /></label><br><br>

  <button type="submit">Generate Invoice</button>
</form>

<pre id="result"></pre>

<!-- Navigation Buttons -->
<button onclick="window.open('history.html', '_blank')">ðŸ“„ Invoice History</button>
<button onclick="window.open('profit.html', '_blank')">ðŸ“Š Daily Profit</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  const { jsPDF } = window.jspdf;
  let itemId = 0;

  function addItem(name = "", price = "", qty = "") {
    const tbody = document.getElementById("itemBody");
    const row = document.createElement("tr");
    row.setAttribute("data-id", itemId);
    row.innerHTML = `
      <td><input type="text" value="${name}" placeholder="Item name" /></td>
      <td><input type="number" value="${price}" min="0" placeholder="Price" /></td>
      <td><input type="number" value="${qty}" min="0" placeholder="Qty" /></td>
      <td><button type="button" onclick="removeItem(${itemId})">X</button></td>
    `;
    tbody.appendChild(row);
    itemId++;
  }

  function removeItem(id) {
    const row = document.querySelector(`tr[data-id='${id}']`);
    if (row) row.remove();
  }

  function formatLine(item, qty, price, total) {
    const padRight = (txt, len) => txt.toString().padEnd(len, ' ');
    const padLeft = (txt, len) => txt.toString().padStart(len, ' ');
    return padRight(item, 12) + padLeft(qty, 5) + padLeft(price, 9) + padLeft(total, 10);
  }

  function saveInvoiceToHistory(invoiceObj) {
    let history = JSON.parse(localStorage.getItem("invoiceHistory")) || [];
    history.push(invoiceObj);
    localStorage.setItem("invoiceHistory", JSON.stringify(history));
  }

  document.getElementById("posForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const discount = parseFloat(document.getElementById("discount").value) || 0;
    const rows = document.querySelectorAll("#itemBody tr");

    let invoiceText = "======== New Station viwe Hotel & Bakery ========\n\n";
    invoiceText += formatLine("Item", "Qty", "Price", "Total") + "\n";
    invoiceText += "---------------------------------------------\n";

    let subtotal = 0;

    rows.forEach(row => {
      const inputs = row.querySelectorAll("input");
      const name = inputs[0].value.trim();
      const price = parseFloat(inputs[1].value);
      const qty = parseInt(inputs[2].value);

      if (name && price > 0 && qty > 0) {
        const total = price * qty;
        subtotal += total;
        invoiceText += formatLine(name, qty, price, total.toFixed(2)) + "\n";
      }
    });

    const finalTotal = Math.max(0, subtotal - discount);

    invoiceText += "---------------------------------------------\n";
    invoiceText += formatLine("Subtotal:", "", "", subtotal.toFixed(2)) + "\n";
    invoiceText += formatLine("Discount:", "", "", discount.toFixed(2)) + "\n";
    invoiceText += "---------------------------------------------\n";
    invoiceText += formatLine("Total to Pay:", "", "", finalTotal.toFixed(2)) + "\n\n";
    invoiceText += "     Thank you for shopping with us!";

    document.getElementById("result").textContent = invoiceText;

    // Save invoice
    saveInvoiceToHistory({
      date: new Date().toISOString(),
      total: finalTotal
    });

    // PDF
    const doc = new jsPDF();
    doc.setFont("courier", "normal");
    doc.setFontSize(16);
    doc.text("New Station viwe Hotel & Bakery", 20, 20);
    doc.setFontSize(12);
    const split = doc.splitTextToSize(invoiceText, 180);
    doc.text(split, 20, 30);
    doc.save("invoice.pdf");
  });

  addItem("Bread", 120, 0);
  addItem("Cake", 1500, 0);
  addItem("Fish Bun", 60, 0);
</script>
</body>
</html>
